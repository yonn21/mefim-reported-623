<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/public/assets/vendor/bootstrap/css/bootstrap.min.css" />
  <link href="/public/assets/vendor/fonts/circular-std/style.css" rel="stylesheet" />
  <link rel="stylesheet" href="/public/assets/libs/css/style.css" />
  <link rel="stylesheet" href="/public/assets/vendor/fonts/fontawesome/css/fontawesome-all.css" />
  <link rel="stylesheet" href="/public/assets/vendor/charts/chartist-bundle/chartist.css" />
  <link rel="stylesheet" href="/public/assets/vendor/charts/morris-bundle/morris.css" />
  <link rel="stylesheet"
    href="/public/assets/vendor/fonts/material-design-iconic-font/css/materialdesignicons.min.css" />
  <link rel="stylesheet" href="/public/assets/vendor/charts/c3charts/c3.css" />
  <link rel="stylesheet" href="/public/assets/vendor/fonts/flag-icon-css/flag-icon.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />

  <title>Thêm phim</title>
  <link rel="icon" href="/public/img/core-img/favicon.ico" />
</head>

<body>
  <div class="dashboard-main-wrapper">
    <!-- ============================================================== -->
    <!-- navbar -->
    <!-- ============================================================== -->
    <div class="dashboard-header">
      <nav class="navbar navbar-expand-lg bg-white fixed-top">
        <a class="navbar-brand" href="/admin/dashboard"><img class="logo-img" src="/public/img/core-img/logo.png"
            alt="logo"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse " id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto navbar-right-top">
            <li class="nav-item dropdown nav-user">
              <a class="nav-link nav-user-img" href="#" id="navbarDropdownMenuLink2" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                <img src="<%= admin.admin_avatar %> " alt="" class="user-avatar-md rounded-circle">
              </a>
              <div class="dropdown-menu dropdown-menu-right nav-user-dropdown"
                aria-labelledby="navbarDropdownMenuLink2">
                <div class="nav-user-info">
                  <% fullName=admin.loginInformation.username %>
                    <h5 class="mb-0 text-white nav-user-name">
                      <%= fullName %>
                    </h5>
                </div>
                <a class="dropdown-item" href="#"><i class="fas fa-user mr-2"></i>Tài khoản</a>
                <a class="dropdown-item" href="/admin/dashboard/logout"><i class="fas fa-power-off mr-2"></i>Đăng
                  xuất</a>
              </div>
            </li>
          </ul>
        </div>
      </nav>
    </div>
    <!-- ============================================================== -->
    <!-- end navbar -->
    <!-- ============================================================== -->

    <!-- ============================================================== -->
    <!-- left sidebar -->
    <!-- ============================================================== -->
    <div class="nav-left-sidebar sidebar-dark">
      <div class="menu-list">
        <nav class="navbar navbar-expand-lg navbar-light">
          <a class="d-xl-none d-lg-none" href="#">Menu</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav flex-column">
              <li class="nav-divider">
                Menu
              </li>
              <li class="nav-item ">
                <div id="submenu-1" class="collapse submenu show">
                  <ul class="nav flex-column">
                    <li class="nav-item">
                      <a class="nav-link" href="/admin/dashboard">Tổng quan</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link active" href="/admin/movie-management/page-1">Quản lý phim</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="/admin/actor-management/page-1">Quản lý diễn viên</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="/admin/director-management/page-1">Quản lý đạo diễn</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="/admin/genre-management/page-1">Quản lý thể loại</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="/admin/rating-management/page-1">Quản lý đánh giá</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="/admin/comment-management/page-1">Quản lý bình luận</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="/admin/user-management/page-1">Quản lý người dùng</a>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
    <!-- ============================================================== -->
    <!-- end left sidebar -->
    <!-- ============================================================== -->

    <div class="dashboard-wrapper">
      <div class="dashboard-ecommerce">
        <div class="container-fluid dashboard-content">
          <div class="row">
            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
              <div class="page-header">
                <h2 class="pageheader-title">Thêm phim</h2>
                <div class="page-breadcrumb">
                  <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item">
                        <a href="/admin/dashboard" class="breadcrumb-link">Menu</a>
                      </li>
                      <li class="breadcrumb-item">
                        <a href="/admin/movie-management/page-1" class="breadcrumb-link">Quản lý phim</a>
                      </li>
                      <li class="breadcrumb-item active" aria-current="page">
                        Thêm phim
                      </li>
                    </ol>
                  </nav>
                </div>
              </div>
            </div>
          </div>
          <div class="content" style="width: 100%; height: 100vh">
            <div class="container-fluid">
              <form class="row g-3" accept-charset="utf-8" spellcheck="false" enctype="multipart/form-data"
                action="/admin/movie-management/add" method="POST">
                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">URL (không dấu, không hoa, không cách, VD:
                    cuoc-song-em-on-khong)</label>
                  <input type="text" name="url_name" class="form-control" id="validationServer01" value="" required
                    onblur="checkDuplicateMovieURL(this.value)" />
                  <div id="urlNameError"></div>
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">Tên chính (Tên đã dịch sang tiếng Việt)</label>
                  <input type="text" name="primary_title" class="form-control" id="validationServer01" value=""
                    required />
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">Tên phụ (Tên gốc)</label>
                  <input type="text" name="secondary_title" class="form-control" id="validationServer01" value=""
                    required />
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">Đạo diễn</label>
                  <div class="search-box">
                    <input type="text" placeholder="Tìm kiếm..." id="director-search-box" />
                  </div>
                  <select name="directors" class="form-control" id="validationServer01" multiple required>
                    <% for (var i=0; i < directors.length; i++) { %>
                      <option value="<%= directors[i].director_url %>">
                        <%= directors[i].director_name %>
                      </option>
                      <% } %>
                  </select>
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer02" class="form-label">Diễn viên</label>
                  <div class="search-box">
                    <input type="text" placeholder="Tìm kiếm..." id="actor-search-box" />
                  </div>
                  <select name="actors" class="form-control" id="validationServer02" multiple required>
                    <% for (var i=0; i < actors.length; i++) { %>
                      <option value="<%= actors[i].actor_url %>">
                        <%= actors[i].actor_name %>
                      </option>
                      <% } %>
                  </select>
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer03" class="form-label">Thể loại</label>
                  <div class="search-box">
                    <input type="text" placeholder="Tìm kiếm..." id="genre-search-box" />
                  </div>
                  <select name="genres" class="form-control" id="validationServer03" multiple required>
                    <% for (var i=0; i < genres.length; i++) { %>
                      <option value="<%= genres[i].genre_url %>">
                        <%= genres[i].genre_name %>
                      </option>
                      <% } %>
                  </select>
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">Năm phát hành</label>
                  <select name="year" class="form-control" id="validationServer01" required>
                    <option value="">Chọn năm</option>
                    <% var currentYear=new Date().getFullYear(); %>
                      <% for (var i=currentYear; i>= 1900; i--) { %>
                        <option value="<%= i %>">
                          <%= i %>
                        </option>
                        <% } %>
                  </select>
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">Quốc gia phát hành</label>
                  <select name="country" class="form-control" id="validationServer01country" required
                    onchange="updateCountryURL()">
                    <option value="">Chọn quốc gia</option>
                    <option value="Âu Mỹ" data-url="au-my">Âu Mỹ</option>
                    <option value="Hàn Quốc" data-url="han-quoc">Hàn Quốc</option>
                    <option value="Trung Quốc" data-url="trung-quoc">Trung Quốc</option>
                    <option value="Nhật Bản" data-url="nhat-ban">Nhật Bản</option>
                    <option value="Đài Loan" data-url="dai-loan">Đài Loan</option>
                    <option value="Hồng Kông" data-url="hong-kong">Hồng Kông</option>
                    <option value="Thái Lan" data-url="thai-lan">Thái Lan</option>
                    <option value="Ấn Độ" data-url="an-do">Ấn Độ</option>
                    <option value="Philippines" data-url="philippines">Philippines</option>
                    <option value="Việt Nam" data-url="viet-nam">Việt Nam</option>
                    <option value="Indonesia" data-url="indonesia">Indonesia</option>
                    <option value="Singapore" data-url="singapore">Singapore</option>
                    <option value="Khác" data-url="khac">Khác</option>
                  </select>
                </div>

                <input type="hidden" name="country_url" id="country_url" value="" />

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">Giới thiệu, mô tả</label>
                  <textarea name="summary" class="form-control" id="validationServer01" required></textarea>
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">Phụ đề</label>
                  <select name="type_sub" class="form-control" id="validationServer01sub" multiple size="3" required>
                    <option value="Raw">Raw</option>
                    <option value="Vietsub">Vietsub</option>
                    <option value="Engsub">Engsub</option>
                  </select>
                </div>

                <label for="formFileMultiple" style="margin: 0 15px;" class="form-label">Thumbnail (Hình chữ nhật
                  đứng)</label>
                <input class="form-control mb-3 mt-1" style="margin: 0 15px; display: inline-block;" type="file"
                  id="formFileMultipleThumbnail" name="thumbnail" required />

                <label for="formFileMultiple" style="margin: 0 15px;" class="form-label">Ảnh bìa (Hình chữ nhật
                  nằm)</label>
                <input class="form-control mb-3 mt-1" style="margin: 0 15px; display: inline-block;" type="file"
                  id="formFileMultipleCoverImage" name="cover_image" required />

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">Link đến trailer</label>
                  <input type="text" name="trailer" class="form-control" id="validationServer01" value="" required />
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <label for="validationServer01" class="form-label">Loại phim</label>
                  <select name="type" class="form-control" id="validationServer01type" required>
                    <option value="">Chọn loại phim</option>
                    <option value="Phim lẻ">Phim lẻ</option>
                    <option value="Phim bộ">Phim bộ</option>
                  </select>
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3" id="seriesDuration" style="display: none;">
                  <label for="durationInput" class="form-label" id="durationLabel">Số tập</label>
                  <input type="number" name="duration" class="form-control" id="durationInput" min="2"
                    placeholder="Nhập số tập lớn hơn 1" />
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3" id="singleMovieDuration" style="display: none;">
                  <div class="row">
                    <div class="col-md-6">
                      <label class="form-label">Thời lượng: Giờ</label>
                      <input type="number" name="duration_hours" class="form-control" id="validationServer01_hours"
                        min="0" max="24" />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Phút</label>
                      <input type="number" name="duration_minutes" class="form-control" id="validationServer01_minutes"
                        min="0" max="60" />
                    </div>
                  </div>
                </div>

                <div class="col-md-12 col-sm-12 col-lg-12 mb-3">
                  <div id="episodesContainer"></div>
                </div>

                <div class="col-12">
                  <button class="btn btn-primary mt-3" type="submit" id="submitForm">
                    Thêm phim
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jquery 3.3.1 -->

    <!-- check duplicate url -->
    <script>
      function checkDuplicateMovieURL(urlName) {
        var urlNameError = document.getElementById("urlNameError");
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/admin/check-duplicate-movie-url", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              var response = JSON.parse(xhr.responseText);
              if (response.isDuplicate) {
                document.getElementById("submitForm").style.opacity = "0.5";
                document.getElementById("submitForm").style.pointerEvents = "none";
                urlNameError.style.color = "red";
                urlNameError.textContent = "URL đã tồn tại. Vui lòng chọn URL khác";
                document.getElementById("validationServer01").focus();
              } else if (!response.isDuplicate) {
                document.getElementById("submitForm").style.opacity = "1";
                document.getElementById("submitForm").style.pointerEvents = "";
                urlNameError.style.color = "green";
                urlNameError.textContent = "URL không trùng";
              }
            } else {
              urlNameError.textContent = "Đã xảy ra lỗi trong quá trình kiểm tra URL";
            }
          }
        };

        if (urlName.trim() === "") {
          urlNameError.style.color = "red";
          urlNameError.textContent = "Vui lòng nhập URL";
          return;
        }

        var data = {
          url_name: urlName.trim()
        };
        xhr.send(JSON.stringify(data));
      }
    </script>

    <!-- search-box -->
    <script>
      function removeDiacritics(str) {
        return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
      }

      const directorSearchBox = document.getElementById('director-search-box');
      const directorOptions = document.querySelectorAll('#validationServer01 option');

      directorSearchBox.addEventListener('input', function () {
        const searchTerm = removeDiacritics(directorSearchBox.value.toLowerCase());

        directorOptions.forEach(function (option) {
          const directorName = removeDiacritics(option.textContent.toLowerCase());

          if (directorName.includes(searchTerm)) {
            option.style.display = 'block';
          } else {
            option.style.display = 'none';
          }
        });
      });

      const actorSearchBox = document.getElementById('actor-search-box');
      const actorOptions = document.querySelectorAll('#validationServer02 option');

      actorSearchBox.addEventListener('input', function () {
        const searchTerm = removeDiacritics(actorSearchBox.value.toLowerCase());

        actorOptions.forEach(function (option) {
          const actorName = removeDiacritics(option.textContent.toLowerCase());

          if (actorName.includes(searchTerm)) {
            option.style.display = 'block';
          } else {
            option.style.display = 'none';
          }
        });
      });

      const genreSearchBox = document.getElementById('genre-search-box');
      const genreOptions = document.querySelectorAll('#validationServer03 option');

      genreSearchBox.addEventListener('input', function () {
        const searchTerm = removeDiacritics(genreSearchBox.value.toLowerCase());

        genreOptions.forEach(function (option) {
          const genreName = removeDiacritics(option.textContent.toLowerCase());

          if (genreName.includes(searchTerm)) {
            option.style.display = 'block';
          } else {
            option.style.display = 'none';
          }
        });
      });
    </script>

    <script>
      function updateCountryURL() {
        var countrySelect = document.getElementById('validationServer01country');
        var selectedCountry = countrySelect.options[countrySelect.selectedIndex];
        var countryURL = selectedCountry.getAttribute('data-url');
        document.getElementById('country_url').value = countryURL;
      }
    </script>

    <!-- Tách chọn thể loại phim -->
    <script>
      const typeSelect = document.getElementById('validationServer01type');

      const singleMovieDuration = document.getElementById('singleMovieDuration');
      const seriesDuration = document.getElementById('seriesDuration');

      const durationInput = document.getElementById('durationInput');
      const hoursInput = document.getElementById('validationServer01_hours');
      const minutesInput = document.getElementById('validationServer01_minutes');

      const episodesContainer = document.getElementById('episodesContainer');

      typeSelect.addEventListener('change', () => {
        if (typeSelect.value === 'Phim bộ') {
          hoursInput.value = '';
          minutesInput.value = '';
          singleMovieDuration.style.display = 'none';
          seriesDuration.style.display = 'block';

          durationInput.required = true;
          hoursInput.required = false;
          minutesInput.required = false;

          durationInput.addEventListener('input', updateEpisodesInput);
          updateEpisodesInput();

        } else if (typeSelect.value === 'Phim lẻ') {
          durationInput.value = '';
          singleMovieDuration.style.display = 'block';
          seriesDuration.style.display = 'none';

          hoursInput.required = true;
          minutesInput.required = true;
          durationInput.required = false;

          durationInput.removeEventListener('input', updateEpisodesInput);
          episodesContainer.innerHTML = '';

          const episodeLabel = document.createElement('label');
          episodeLabel.className = 'form-label';
          episodeLabel.textContent = 'Nhập link đến xem phim';
          const episodeInput = document.createElement('input');
          episodeInput.type = 'text';
          episodeInput.name = 'episodes';
          episodeInput.className = 'form-control';
          episodeInput.required = true;
          episodesContainer.appendChild(episodeLabel);
          episodesContainer.appendChild(episodeInput);
        }

        function updateEpisodesInput() {
          const duration = parseInt(durationInput.value);
          episodesContainer.innerHTML = '';
          if (!isNaN(duration) && duration >= 2) {
            const episodeLabel = document.createElement('label');
            episodeLabel.className = 'form-label';
            episodeLabel.textContent = 'Nhập link đến xem phim';
            episodesContainer.appendChild(episodeLabel);
            const episodeInput = document.createElement('input');
            episodeInput.type = 'text';
            episodeInput.name = 'episodes';
            episodeInput.className = 'form-control';
            episodeInput.placeholder = 'Nhập link phim tập 1';
            episodeInput.required = true;
            episodesContainer.appendChild(episodeInput);
            for (let i = 2; i <= duration; i++) {
              const episodeInput = document.createElement('input');
              episodeInput.type = 'text';
              episodeInput.name = 'episodes';
              episodeInput.className = 'form-control';
              episodeInput.placeholder = 'Nhập link phim tập ' + i;
              episodesContainer.appendChild(episodeInput);
            }
          }
        }
      });
    </script>

    <!-- multi select -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $('option').mousedown(function (e) {
        e.preventDefault();
        var originalScrollTop = $(this).parent().scrollTop();
        $(this).prop('selected', $(this).prop('selected') ? false : true);
        var self = this;
        $(this).parent().focus();
        setTimeout(function () {
          $(self).parent().scrollTop(originalScrollTop);
        }, 0);

        return false;
      });
    </script>

    <script src="/public/assets/vendor/jquery/jquery-3.3.1.min.js"></script>
    <!-- bootstap bundle js -->
    <script src="/public/assets/vendor/bootstrap/js/bootstrap.bundle.js"></script>
    <!-- slimscroll js -->
    <script src="/public/assets/vendor/slimscroll/jquery.slimscroll.js"></script>
    <!-- main js -->
    <script src="/public/assets/libs/js/main-js.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
</body>

</html>